# AGENTS.md 改善メモ（2025-10-19）

## 概要
AGENTS.md を上から順に精読し、曖昧な指示・矛盾点・構造面の課題を洗い出した結果のメモ。ここで挙げた指摘を元に、次回メンテの際に文書を再編成・追記することを推奨する。

## 曖昧な指示・不完全な記述
- **優先順位の不明瞭さ**  
  システム指示 / 開発者指示 / ユーザー指示 / AGENTS.md の優先順位が明文化されておらず、衝突時の扱いが曖昧。
- **ASSESS 手順で想定されているリソース**  
  「グラフ知識ベースを照会」「クロから共有」とあるが、実際には利用できないリソースが前提になっている。代替手順やスキップ条件を明示する必要がある。
- **Gemini CLI の利用条件**  
  いつ・どの優先度で gemini コマンドを使うべきか、現環境でコマンドが存在しない場合の扱いが記載されていない。
- **アプリ開発フローの適用範囲**  
  「即実装禁止」「要件定義必須」などが常に適用されるのか、小規模改修でも従うのかが不明。
- **TodoWrite ツール依存**  
  完全完了条件として TodoWrite ツールを前提にしているが、実際は利用できないため条件が満たせない。
- **フォアグラウンド実行の例外規定**  
  （今回追記したバックグラウンド運用ルールを除き）リアルタイム出力を求められた場合の具体的な対応や、許可の取り方が記述されていない。

## 矛盾・実務と噛み合わない点
- **「対処療法完全禁止」と時間制約**  
  緊急対応時も根本原因に到達するまで完了扱いにできないと読めるが、現実的に段階的対応が必要な場面の例外規定がない。
- **「Gemini 連携」 vs 「ネットワーク利用制限」**  
  ネットワークアクセスが制限される環境設定でも gemini 利用を前提としており、ポリシーと矛盾する可能性がある。
- **「即実装禁止」 vs 既に進行中の実装タスク**  
  進行中プロジェクトの小変更にも要件定義フェーズからやり直すのか、例外をどこで認めるのか矛盾が生じやすい。
- **「判断フレームワークを必ず適用」**  
  単純作業でも ASSESS の6ステップを要求しているように読め、実作業とのバランスが取れていない。

## 構造・メンテナンス上の課題
- **章立ての重複と冗長さ**  
  「行動指針」「判断基準」「思考システム」など似た内容が繰り返し登場し、重要度の高いルールが埋もれやすい。
- **章の順番がバラバラ**  
  キャラクター設定 → 判断基準 → 連携ガイド → アプリ開発フロー → コーディング規約と続き、運用面のルール（サーバ起動・報告手順等）が散在している。
- **目次・要約が無い**  
  600行超の文書を毎回読み返すのが現実的でなく、TLDじゃない。
- **更新履歴・バージョン管理が無い**  
  いつ・誰が・なぜ更新したか追跡できず、差分の影響が判断しづらい。
- **外部 CLI 依存の扱い**  
  Claude/Gemini などのサブツールの説明が本文中に長く書かれており、本体ルールとの差分が読み取りにくい。

## 改善提案（草案）
1. **冒頭に TL;DR と優先順位表を追加**  
   指示の優先順位と主要ルールをコンパクトにまとめ、詳細は後続セクションに飛べるようにする。
2. **利用できないリソースの扱いを明記**  
   グラフDB・他AIとの連携が使えない場合の代替ステップやスキップ手順を追記。
3. **CLI 連携章の再編成**  
   Gemini / Claude など外部連携は別添ドキュメントに切り出すか、利用条件・前提コマンドの存在確認フローを追加。
4. **アプリ開発フローの適用条件を定義**  
   新規プロダクト開始時のみ適用する/小規模改修時は簡略化する 等のガイドラインを記述。
5. **タスク完了条件の再定義**  
   TodoWrite ツール前提を外し、現行環境で検証可能なチェックリストに置き換える。
6. **長時間タスク運用ルールを章立てで整理**  
   今回追加したバックグラウンド指針を含め、サーバ運用・ログ共有・停止方法をまとめた章を用意する。
7. **更新履歴セクションの追加**  
   ドキュメント冒頭または末尾に YYYY-MM-DD + 変更概要 + 担当を記録するテーブルを設ける。

## 次のアクション候補
- 上記改善案をベースに新アウトライン（例: TL;DR → 優先順位 → 行動原則 → オペレーション手順 → 連携ガイド → 付録）を作成。
- 実運用で不要になったセクション（例: 具体的なGeminiコマンド例）があれば簡素化。
- ドキュメント編集後は diff とチェックリストを添えて共有し、関係者合意の上で確定版をリリースする。
